<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AiUoVsix.Command.EntityFrameworkCore.ViewModels"
        xmlns:views="using:AiUoVsix.Command.EntityFrameworkCore.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
        x:Class="AiUoVsix.Command.EntityFrameworkCore.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="ä»Žæ•°æ®åº“åˆ›å»ºå®žä½“ - AiUoVsix EntityFramework Core"
        MinWidth="1200" MinHeight="700"
        Background="#F8FAFC">

    <Window.Resources>
        <views:BooleanNegationConverter x:Key="BoolNegationConverter"/>
        <views:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>
    
    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <!-- çŽ°ä»£åŒ–å¡ç‰‡æ ·å¼ -->
        <Style Selector="Border.card">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BoxShadow" Value="0 2 8 0 #10000000"/>
            <Setter Property="Margin" Value="4"/>
        </Style>
        
        <!-- ä¸»è¦æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#3B82F6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#2563EB"/>
        </Style>
        
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#F3F4F6"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="#E5E7EB"/>
        </Style>
        
        <Style Selector="Button.icon">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.icon:pointerover">
            <Setter Property="Background" Value="#F3F4F6"/>
        </Style>
        
        <!-- æ ‡é¢˜æ ·å¼ -->
        <Style Selector="TextBlock.title">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="TextBlock.subtitle">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="TextBlock.caption">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <!-- ç§»é™¤TreeViewè‡ªå®šä¹‰æ ·å¼ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼ -->
        
        <!-- DataGrid æ ·å¼ -->
        <Style Selector="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
        </Style>
        <Style Selector="DataGridColumnHeader">
            <Setter Property="Background" Value="#F9FAFB"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
        </Style>
        <Style Selector="DataGridRow">
            <Setter Property="Background" Value="White"/>
        </Style>
        <Style Selector="DataGridRow:nth-child(even)">
            <Setter Property="Background" Value="#F9FAFB"/>
        </Style>
        <Style Selector="DataGridRow:pointerover">
            <Setter Property="Background" Value="#F0F9FF"/>
        </Style>
        <Style Selector="DataGridCell">
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
        </Style>
        
        <!-- å…¨å±€æ–‡æœ¬æ ·å¼ -->
        <Style Selector="TextBlock">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="Label">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="CheckBox TextBlock">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="ComboBox TextBlock">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <!-- CheckBox æ ·å¼ -->
        <Style Selector="CheckBox">
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="3"/>
        </Style>
        
        <Style Selector="CheckBox:checked">
            <Setter Property="Background" Value="#3B82F6"/>
            <Setter Property="BorderBrush" Value="#3B82F6"/>
        </Style>
        
        <Style Selector="CheckBox:pointerover">
            <Setter Property="BorderBrush" Value="#9CA3AF"/>
        </Style>
    </Window.Styles>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="White" 
                BorderBrush="#E5E7EB" BorderThickness="0,0,0,1"
                Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                 
                
                <!-- è¿žæŽ¥çŠ¶æ€å’Œæ“ä½œ -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                    <!-- è¿žæŽ¥çŠ¶æ€ -->
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="è¿žæŽ¥çŠ¶æ€:" Classes="caption" VerticalAlignment="Center"/>
                        <Border Background="{Binding DatabaseBrowser.IsConnected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#10B981,#EF4444'}" 
                                CornerRadius="12" Padding="8,4">
                            <TextBlock Text="{Binding DatabaseBrowser.ConnectionStatus}" 
                                       Foreground="White" 
                                       FontSize="12" 
                                       FontWeight="Medium"/>
                        </Border>
                    </StackPanel>
                    
                    <!-- ä¸»è¦æ“ä½œæŒ‰é’® -->
                    <Button Content="âš¡ ç”Ÿæˆå®žä½“" 
                            Command="{Binding DatabaseBrowser.GenerateEntityCommand}"
                            Classes="primary"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- æ•°æ®åº“è¿žæŽ¥åŒºåŸŸ -->
        <Border Grid.Row="1" Background="#F8FAFC" 
                BorderBrush="#E5E7EB" BorderThickness="0,0,0,1"
                Padding="16,12">
            <Border Classes="card" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- è¿žæŽ¥æ ‡é¢˜ -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Margin="0,0,16,0">
                        <TextBlock Text="ðŸ—„ï¸" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="æ•°æ®åº“è¿žæŽ¥" Classes="subtitle" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- è¿žæŽ¥é€‰æ‹© -->
                    <ComboBox Grid.Column="1" 
                              ItemsSource="{Binding Connections}"
                              SelectedItem="{Binding SelectedConnection}"
                              HorizontalAlignment="Stretch"
                              Height="32"
                              Margin="0,0,12,0">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:DatabaseConnectionViewModel">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="ðŸ—„ï¸" FontSize="14" VerticalAlignment="Center"/>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="Medium"/>
                                        <TextBlock Text="{Binding DatabaseType}" FontSize="12" Foreground="#6B7280"/>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <!-- è¿žæŽ¥æ“ä½œæŒ‰é’® -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center" Margin="0,0,12,0">
                        <Button Content="âž•" 
                                Command="{Binding AddConnectionCommand}"
                                Classes="secondary"
                                ToolTip.Tip="æ–°å»ºè¿žæŽ¥"
                                Width="32" Height="32"/>
                        <Button Content="âœï¸" 
                                Command="{Binding EditConnectionCommand}"
                                Classes="secondary"
                                IsEnabled="{Binding SelectedConnection, Converter={x:Static ObjectConverters.IsNotNull}}"
                                ToolTip.Tip="ç¼–è¾‘è¿žæŽ¥"
                                Width="32" Height="32"/>
                        <Button Content="ðŸ—‘ï¸" 
                                Command="{Binding DeleteConnectionCommand}"
                                Classes="secondary"
                                IsEnabled="{Binding SelectedConnection, Converter={x:Static ObjectConverters.IsNotNull}}"
                                ToolTip.Tip="åˆ é™¤è¿žæŽ¥"
                                Width="32" Height="32"/>
                    </StackPanel>
                    
                    <!-- åˆ·æ–°æŒ‰é’® -->
                    <Button Grid.Column="3" 
                            Content="ðŸ”„ åˆ·æ–°æ•°æ®åº“" 
                            Command="{Binding DatabaseBrowser.RefreshDatabaseObjectsCommand}"
                            Classes="primary"/>
                </Grid>
            </Border>
        </Border>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="2" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" MinWidth="300"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
            </Grid.ColumnDefinitions>
            
            <!-- å·¦ä¾§é¢æ¿ - æ•°æ®åº“å¯¹è±¡ -->
            <Border Grid.Column="0" Classes="card" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="ðŸ“Š" FontSize="18" VerticalAlignment="Center"/>
                        <TextBlock Text="æ•°æ®åº“å¯¹è±¡" Classes="subtitle" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <ScrollViewer Grid.Row="2">
                        <TreeView ItemsSource="{Binding DatabaseBrowser.DatabaseObjectTree}"
                                  SelectedItem="{Binding DatabaseBrowser.SelectedTreeNode}">
                            <TreeView.ItemTemplate>
                                <TreeDataTemplate ItemsSource="{Binding Children}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <CheckBox IsChecked="{Binding IsChecked}"/>
                                        <TextBlock Text="{Binding Icon}" 
                                                   FontSize="14"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Name}" 
                                                   FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </TreeDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </ScrollViewer>
                    
                    <Button Grid.Row="4" Content="ðŸ—‘ï¸ æ¸…ç©ºé€‰æ‹©" 
                            Command="{Binding DatabaseBrowser.UnselectAllCommand}"
                            Classes="secondary"
                            HorizontalAlignment="Stretch"/>
                </Grid>
            </Border>
            
            <!-- åˆ†éš”çº¿ -->
            <GridSplitter Grid.Column="1" 
                          Background="#E5E7EB"
                          HorizontalAlignment="Center"
                          Width="1"/>
            
            <!-- å³ä¾§é¢æ¿ - è¡¨ç»“æž„ -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="16"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- è¡¨åˆ—ä¿¡æ¯ -->
                <Border Grid.Row="0" Classes="card" Padding="16">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“‹" FontSize="18" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding DatabaseBrowser.SelectedTableName, StringFormat='è¡¨ç»“æž„ - {0}'}" 
                                       Classes="subtitle"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <DataGrid Grid.Row="2" 
                                  ItemsSource="{Binding DatabaseBrowser.TableColumns}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  IsVisible="{Binding DatabaseBrowser.TableColumns, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="åˆ—å" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="æ•°æ®ç±»åž‹" Binding="{Binding DataType}" Width="120"/>
                                <DataGridTextColumn Header="é•¿åº¦" Binding="{Binding MaxLength}" Width="80"/>
                                <DataGridCheckBoxColumn Header="å¯ç©º" Binding="{Binding IsNullable}" Width="60"/>
                                <DataGridCheckBoxColumn Header="ä¸»é”®" Binding="{Binding IsPrimaryKey}" Width="60"/>
                                <DataGridTextColumn Header="é»˜è®¤å€¼" Binding="{Binding DefaultValue}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <StackPanel Grid.Row="2" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center"
                                    Spacing="16"
                                    IsVisible="{Binding DatabaseBrowser.TableColumns, Converter={x:Static ObjectConverters.IsNull}}">
                            <TextBlock Text="ðŸ“‹" FontSize="48" Foreground="#D1D5DB" HorizontalAlignment="Center"/>
                            <TextBlock Text="è¯·é€‰æ‹©ä¸€ä¸ªè¡¨æŸ¥çœ‹åˆ—ä¿¡æ¯" 
                                       Classes="caption" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- ç”Ÿæˆé€‰é¡¹ -->
                <Border Grid.Row="2" Classes="card" Padding="16">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="âš™ï¸" FontSize="18" VerticalAlignment="Center"/>
                            <TextBlock Text="ç”Ÿæˆé€‰é¡¹" Classes="subtitle" VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Spacing="12">
                                <CheckBox Content="ç”Ÿæˆæ•°æ®æ³¨è§£" IsChecked="True" FontSize="14"/>
                                <CheckBox Content="ç”Ÿæˆå¯¼èˆªå±žæ€§" IsChecked="True" FontSize="14"/>
                                <CheckBox Content="ä½¿ç”¨å¯ç©ºå¼•ç”¨ç±»åž‹" IsChecked="True" FontSize="14"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Spacing="8">
                                <TextBlock Text="å‘½åç©ºé—´" FontWeight="Medium" FontSize="14"/>
                                <TextBox Text="MyProject.Models" 
                                         Watermark="è¯·è¾“å…¥å‘½åç©ºé—´" 
                                         FontSize="14"
                                         Height="40"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
        
        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="3" Background="White" 
                BorderBrush="#E5E7EB" BorderThickness="0,1,0,0"
                Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="çŠ¶æ€:" FontWeight="Medium" FontSize="14"/>
                    <TextBlock Text="{Binding DatabaseBrowser.StatusMessage}" FontSize="14" Foreground="#6B7280"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" 
                                 IsVisible="{Binding DatabaseBrowser.IsLoading}" 
                                 Width="120" Height="6" 
                                 VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- æ•°æ®åº“è¿žæŽ¥ç¼–è¾‘å¼¹å‡ºæ¡† -->
        <Panel IsVisible="{Binding IsEditingConnection}" 
               Background="#80000000" 
               ZIndex="1000">
            <Border Background="White" 
                    CornerRadius="16" 
                    BoxShadow="0 20 40 #20000000" 
                    MaxWidth="600" 
                    MaxHeight="700" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    Margin="40">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- æ ‡é¢˜æ  -->
                    <Border Grid.Row="0" Background="#3B82F6" 
                            CornerRadius="16,16,0,0" 
                            Padding="24,20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" 
                                       Text="æ•°æ®åº“è¿žæŽ¥è®¾ç½®" 
                                       Foreground="White" 
                                       FontSize="20" 
                                       FontWeight="Bold" 
                                       VerticalAlignment="Center"/>
                            
                            <Button Grid.Column="1" 
                                    Content="âœ•" 
                                    Command="{Binding CancelEditConnectionCommand}" 
                                    Classes="icon"
                                    Foreground="White" 
                                    FontSize="18" 
                                    Width="36" 
                                    Height="36"/>
                        </Grid>
                    </Border>
                    
                    <!-- å†…å®¹åŒºåŸŸ -->
                    <ScrollViewer Grid.Row="1" 
                                  Padding="24" 
                                  VerticalScrollBarVisibility="Auto">
                        <views:DatabaseConnectionEditView DataContext="{Binding CurrentConnection}"/>
                    </ScrollViewer>
                    
                    <!-- åº•éƒ¨æŒ‰é’® -->
                    <Border Grid.Row="2" Background="#F8FAFC" 
                            CornerRadius="0,0,16,16"
                            Padding="24,20">
                        <StackPanel Orientation="Horizontal" 
                                    HorizontalAlignment="Right" 
                                    Spacing="12">
                            <Button Content="ðŸ’¾ ä¿å­˜" 
                                    Command="{Binding SaveConnectionCommand}"
                                    Classes="primary"/>
                            <Button Content="âŒ å–æ¶ˆ" 
                                    Command="{Binding CancelEditConnectionCommand}"
                                    Classes="secondary"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Panel>
    </Grid>

</Window>
