<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AiUoVsix.Command.EntityFrameworkCore.ViewModels"
        xmlns:views="using:AiUoVsix.Command.EntityFrameworkCore.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
        x:Class="AiUoVsix.Command.EntityFrameworkCore.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="æ•°æ®åº“è¿žæŽ¥ç®¡ç† - AiUoVsix EntityFramework Core"
        MinWidth="900" MinHeight="600"
        Background="#F5F5F7">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <!-- çŽ°ä»£åŒ–å¡ç‰‡æ ·å¼ -->
        <Style Selector="Border.card">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BoxShadow" Value="0 2 8 0 #1A000000"/>
            <Setter Property="Margin" Value="8"/>
        </Style>
        
        <!-- ä¸»è¦æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#005BAC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="BorderThickness" Value="0"/> 
        </Style>
        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#003E73"/>
        </Style>
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#F3F4F6"/>
            <Setter Property="Foreground" Value="#222"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#B0B0B0"/>
        </Style>
        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="#E0E0E0"/>
        </Style>
        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#D32F2F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="Button.danger:pointerover">
            <Setter Property="Background" Value="#B71C1C"/>
        </Style>
        <Style Selector="TextBlock.section-title">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#222"/>
            <Setter Property="FontFamily" Value="Segoe UI, Arial, sans-serif"/>
        </Style>
        <Style Selector="TextBlock.subtitle">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="FontFamily" Value="Segoe UI, Arial, sans-serif"/>
        </Style>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BoxShadow" Value="0 2 8 0 #1A000000"/>
            <Setter Property="Margin" Value="12"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <!-- ä¸»è¦æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#007ACC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#005A9E"/>
        </Style>
        
        <!-- æ¬¡è¦æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#F3F4F6"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
        </Style>
        
        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="#E5E7EB"/>
        </Style>
        
        <!-- å±é™©æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#EF4444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="Button.danger:pointerover">
            <Setter Property="Background" Value="#DC2626"/>
        </Style>
        
        <!-- æ ‡é¢˜æ ·å¼ -->
        <Style Selector="TextBlock.section-title">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1F2937"/>
        </Style>
        
        <!-- å­æ ‡é¢˜æ ·å¼ -->
        <Style Selector="TextBlock.subtitle">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#6B7280"/>
        </Style>
        
        <!-- çŽ°ä»£åŒ–ListBoxæ ·å¼ -->
        <Style Selector="ListBox.modern">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="ListBox.modern ListBoxItem">
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="4,2"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        
        <Style Selector="ListBox.modern ListBoxItem:selected">
            <Setter Property="Background" Value="#E0F2FE"/>
            <Setter Property="BorderBrush" Value="#0EA5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style Selector="ListBox.modern ListBoxItem:pointerover">
            <Setter Property="Background" Value="#F8FAFC"/>
        </Style>
        
        <!-- çŽ°ä»£åŒ–TreeViewæ ·å¼ -->
        <Style Selector="TreeView.modern">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="TreeView.modern TreeViewItem">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2,1"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        
        <Style Selector="TreeView.modern TreeViewItem:selected">
            <Setter Property="Background" Value="#E0F2FE"/>
        </Style>
        
        <!-- çŽ°ä»£åŒ–DataGridæ ·å¼ -->
        <Style Selector="DataGrid.modern">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#F3F4F6"/>
        </Style>
    </Window.Styles>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320" MinWidth="280"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="320" MinWidth="280"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="*" MinWidth="450"/>
        </Grid.ColumnDefinitions>
        
        <!-- å·¦ä¾§è¿žæŽ¥åˆ—è¡¨ -->
        <Border Grid.Column="0" Classes="card">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- æ ‡é¢˜æ  -->
                <Border Grid.Row="0" Background="#007ACC" 
                        CornerRadius="8,8,0,0"
                        Padding="20,16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="ðŸ”—" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="æ•°æ®åº“è¿žæŽ¥" 
                                   Foreground="White" 
                                   Classes="section-title"/>
                    </StackPanel>
                </Border>
                
                <!-- è¿žæŽ¥åˆ—è¡¨ -->
                <ScrollViewer Grid.Row="1" Margin="8">
                    <ListBox ItemsSource="{Binding Connections}"
                             SelectedItem="{Binding SelectedConnection}"
                             Classes="modern">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:DatabaseConnectionViewModel">
                                <Border CornerRadius="6" Padding="4">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{Binding Name}" 
                                                   FontWeight="SemiBold" 
                                                   FontSize="15"
                                                   Foreground="#1F2937"/>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border Background="#E0F2FE" 
                                                    CornerRadius="12" 
                                                    Padding="8,2">
                                                <TextBlock Text="{Binding DatabaseType}" 
                                                           FontSize="11"
                                                           FontWeight="Medium"
                                                           Foreground="#0369A1"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Server}" 
                                                   Classes="subtitle"
                                                   FontSize="12"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <Border Grid.Row="2" Background="#F8FAFC" 
                        CornerRadius="0,0,8,8"
                        Padding="16,12">
                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                Spacing="8">
                        <Button Content="âž• æ–°å¢ž" 
                                Command="{Binding AddConnectionCommand}"
                                Classes="primary"/>
                        <Button Content="âœï¸ ç¼–è¾‘" 
                                Command="{Binding EditConnectionCommand}"
                                Classes="secondary"/>
                        <Button Content="ðŸ—‘ï¸ åˆ é™¤" 
                                Command="{Binding DeleteConnectionCommand}"
                                Classes="danger"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        
        <!-- åˆ†éš”çº¿ -->
        <GridSplitter Grid.Column="1" 
                      Background="Transparent"
                      HorizontalAlignment="Stretch"/>
        
        <!-- ä¸­é—´æ•°æ®åº“æµè§ˆå™¨ -->
        <Border Grid.Column="2" Classes="card">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- æ•°æ®åº“æµè§ˆå™¨æ ‡é¢˜ -->
                <Border Grid.Row="0" Background="#10B981" 
                        CornerRadius="8,8,0,0"
                        Padding="20,16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="ðŸ—‚ï¸" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="æ•°æ®åº“å¯¹è±¡" 
                                   Foreground="White" 
                                   Classes="section-title"/>
                    </StackPanel>
                </Border>
                
                <!-- æ•°æ®åº“å¯¹è±¡æ ‘ -->
                <Grid Grid.Row="1" Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- è¿žæŽ¥çŠ¶æ€ -->
                    <Border Grid.Row="0" Background="#F0F9FF" 
                            CornerRadius="6" 
                            Padding="12,8" 
                            Margin="0,0,0,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“Š" FontSize="14" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding DatabaseBrowser.ConnectionStatus}" 
                                       Classes="subtitle"
                                       FontSize="13"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- æ ‘å½¢è§†å›¾ -->
                    <ScrollViewer Grid.Row="1">
                        <TreeView ItemsSource="{Binding DatabaseBrowser.DatabaseObjectTree}"
                                  SelectedItem="{Binding DatabaseBrowser.SelectedTreeNode}"
                                  Classes="modern">
                            <TreeView.ItemTemplate>
                                <TreeDataTemplate ItemsSource="{Binding Children}">
                                    <Border CornerRadius="4" Padding="8,4">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <CheckBox IsChecked="{Binding IsChecked}" 
                                                      VerticalAlignment="Center"
                                                      Margin="0"/>
                                            <TextBlock Text="{Binding Icon}" 
                                                       FontSize="14" 
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Name}" 
                                                       FontSize="13" 
                                                       FontWeight="Medium"
                                                       Foreground="#374151"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </TreeDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Border>
        
        <!-- åˆ†éš”çº¿ -->
        <GridSplitter Grid.Column="3" 
                      Background="Transparent"
                      HorizontalAlignment="Stretch"/>
        
        <!-- å³ä¾§è¯¦æƒ…åŒºåŸŸ -->
        <Border Grid.Column="4" Classes="card">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- ç¼–è¾‘æ¨¡å¼å†…å®¹ -->
                <Grid Grid.Row="0" Grid.RowSpan="3" IsVisible="{Binding IsEditing}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- ç¼–è¾‘åŒºåŸŸæ ‡é¢˜ -->
                    <Border Grid.Row="0" Background="#8B5CF6" 
                            CornerRadius="8,8,0,0"
                            Padding="20,16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="âœï¸" FontSize="16" VerticalAlignment="Center"/>
                            <TextBlock Text="ç¼–è¾‘æ•°æ®åº“è¿žæŽ¥" 
                                       Foreground="White"
                                       Classes="section-title"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- ç¼–è¾‘è¡¨å• -->
                    <ScrollViewer Grid.Row="1" Margin="16">
                        <views:DatabaseConnectionEditView DataContext="{Binding CurrentConnection}"/>
                    </ScrollViewer>
                    
                    <!-- ä¿å­˜/å–æ¶ˆæŒ‰é’® -->
                    <Border Grid.Row="2" Background="#F8FAFC" 
                            CornerRadius="0,0,8,8"
                            Padding="20,16">
                        <StackPanel Orientation="Horizontal" 
                                    HorizontalAlignment="Right" 
                                    Spacing="12">
                            <Button Content="ðŸ’¾ ä¿å­˜" 
                                    Command="{Binding SaveConnectionCommand}"
                                    Classes="primary"/>
                            <Button Content="âŒ å–æ¶ˆ" 
                                    Command="{Binding CancelEditCommand}"
                                    Classes="secondary"/>
                        </StackPanel>
                    </Border>
                </Grid>
                
                <!-- è¡¨å­—æ®µè¯¦æƒ… -->
                <Grid Grid.Row="0" Grid.RowSpan="3" IsVisible="{Binding !IsEditing}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- è¯¦æƒ…æ ‡é¢˜ -->
                    <Border Grid.Row="0" Background="#F59E0B" 
                            CornerRadius="8,8,0,0"
                            Padding="20,16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“‹" FontSize="16" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding DatabaseBrowser.SelectedTableName, StringFormat='è¡¨: {0}'}" 
                                       Foreground="White"
                                       Classes="section-title"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <Border Grid.Row="1" Background="#FEF3C7" 
                            Padding="16,12">
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="ðŸ“Š" FontSize="14" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding DatabaseBrowser.TableColumns.Count, StringFormat='åˆ—æ•°: {0}'}" 
                                           Classes="subtitle"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="ðŸ”‘" FontSize="14" VerticalAlignment="Center"/>
                                <TextBlock Text="ä¸»é”®åˆ—" 
                                           Classes="subtitle"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- å­—æ®µåˆ—è¡¨ -->
                     <ScrollViewer Grid.Row="2" Margin="16">
                         <DataGrid ItemsSource="{Binding DatabaseBrowser.TableColumns}"
                                   IsReadOnly="True"
                                   Classes="modern"
                                   AutoGenerateColumns="False">
                             <DataGrid.Columns>
                                 <DataGridTextColumn Header="ðŸ·ï¸ å­—æ®µå" Binding="{Binding Name}" Width="150"/>
                                 <DataGridTextColumn Header="ðŸ”§ æ•°æ®ç±»åž‹" Binding="{Binding DataType}" Width="140"/>
                                 <DataGridTextColumn Header="â“ å¯ç©º" Binding="{Binding IsNullable}" Width="80"/>
                                 <DataGridTextColumn Header="ðŸ”‘ ä¸»é”®" Binding="{Binding IsPrimaryKey}" Width="70"/>
                                 <DataGridTextColumn Header="âš™ï¸ é»˜è®¤å€¼" Binding="{Binding DefaultValue}" Width="120"/>
                                 <DataGridTextColumn Header="ðŸ’¬ æ³¨é‡Š" Binding="{Binding Comment}" Width="*"/>
                             </DataGrid.Columns>
                         </DataGrid>
                     </ScrollViewer>
                </Grid>
            </Grid>
        </Border>
    </Grid>

</Window>
